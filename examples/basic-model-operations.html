<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../img/favicon.ico">

    <title>xBIM</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="../css/site.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>

  </head>
<!-- NAVBAR
================================================== -->
  <body>

    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">xBIM</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          		   
	<ul class="nav navbar-nav">
        <li>
			<a href="../quick-start.html">Quick Start</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Examples <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
        <li>
			<a href="../examples/basic-model-operations.html">Basic Model Operations</a>
		</li>
        <li>
			<a href="../examples/change-log-creation.html">Change Log Creation</a>
		</li>
        <li>
			<a href="../examples/creating-wexbim-file.html">Creating wexBIM file</a>
		</li>
        <li>
			<a href="../examples/insert-copy-function.html">Insert Copy Function</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">License <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
        <li>
			<a href="../license/license.html">License</a>
		</li>
        <li>
			<a href="../license/third-party-licenses.html">Third Party Licenses</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">xBIM 4 <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
        <li>
			<a href="../xbim-4/fast-upgrade-track.html">Fast Upgrade Track</a>
		</li>
        <li>
			<a href="../xbim-4/xbim-4-release-notes.html">xBIM 4 Release Notes</a>
		</li>
    </ul>

		</li>
    </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>
	<div class="banner architecture">
		<h1>
		    The xBIM Toolkit <br />
		    <small>eXtensible Building Information Modelling </small>
		</h1>
	</div>

		<div class="container">

<h1>Basic model operations</h1>

<p>To get started the easiest way to get xBIM into your project is to use <a href="https://www.nuget.org/packages?q=xbim">NuGet</a>. To do anything you want with the data you only need 
<a href="https://www.nuget.org/packages/Xbim.Essentials/">xBIM Essentials</a>. If you need anything to do with geometry (like visualization) you will also need 
<a href="https://www.nuget.org/packages/Xbim.Geometry/">xBIM Geometry Engine</a>. There are many years of development behind xBIM and both these packages are mature and pretty much stable.</p>

<p>Now it's probably time to have a look at some very basic code examples representing how xBIM can be used. We will present four basic functions of persistent storage well known as 
<a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> (Create, Retrieve, Update and Delete). Following examples usually work with IFC4 but you can also do the same
with IFC2x3. Actually most of the code is IFC version agnostic as it uses IFC4 interfaces which work for IFC2x3 as well. Sample data used to develop these examples can be downloaded
<a href="../data/SampleHouse.zip">here</a>.</p>

<h2>Create</h2>

<p>Following example will create simple IFC model without any geometry. As you can see <code>IfcStore</code> takes a configuration object <code>XbimEditorCredentials</code> representing
current application and user and uses it to maintain <code>OwnerHistory</code> of root entities. This is a requirement and
makes it easier to handle one of the many aspects needed to create compliant IFC models. This IFC doesn't define any <a href="http://www.buildingsmart-tech.org/specifications/ifc-view-definition">Model View Definition (MVD)</a>
so there are no additional restrictions apart from <code>WHERE</code> rules and required properties. You should always set editor credentials and fill it in with initials of your application
and your current user.</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">var</span> editor = <span style="color:Blue;">new</span> XbimEditorCredentials
{
    ApplicationDevelopersName = <span style="color:#A31515;">&quot;xBIM Team&quot;</span>,
    ApplicationFullName = <span style="color:#A31515;">&quot;xBIM Toolkit&quot;</span>,
    ApplicationIdentifier = <span style="color:#A31515;">&quot;xBIM&quot;</span>,
    ApplicationVersion = <span style="color:#A31515;">&quot;4.0&quot;</span>,
    EditorsFamilyName = <span style="color:#A31515;">&quot;Santini Aichel&quot;</span>,
    EditorsGivenName = <span style="color:#A31515;">&quot;Johann Blasius&quot;</span>,
    EditorsOrganisationName = <span style="color:#A31515;">&quot;Independent Architecture&quot;</span>
};
</pre></div>

<p>All implementations of <code>IModel</code> in xBIM are <code>IDisposable</code> so you should always use them inside of <code>using</code> statement like this</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> model = IfcStore.Create(editor, IfcSchemaVersion.Ifc4, XbimStoreType.InMemoryModel))
{
    <span style="color:Green;">//...do something with the model</span>
}
</pre></div>

<p>If you are going to create or modify anything in the model you have to use transactions. These should also be used inside of <code>using</code> statement
so they have a proper scope for eventual roll-back operation in case something happens. You have to commit transaction explicitly to keep the changes.
Transactions can't be nested so there has always be just one transaction at the time.</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> txn = model.BeginTransaction(<span style="color:#A31515;">&quot;Hello Wall&quot;</span>))
{
    <span style="color:Green;">//....do something in the scope of this transaction</span>
    txn.Commit()
}
</pre></div>

<p>All operations related to entities are accessible through <code>IModel.Instances</code>. That is your point of access to get, change and create new
entities in the model. To create any new object you use this templated function. You always have to specify a non-abstract type to create. This is
built in xBIM in a way where you get a compile time error if you don't. 
Every model is schema specific so it is either IFC2x3 or IFC4 or other specific schema. <code>IfcStore</code> makes it easier because it can open both IFC versions 
and will tell you what it is but when you want to create data make sure you don't mess up your <code>using</code> statements. If you try to create IFC4 entity
with model initialized to IFC2x3 it will throw a runtime exception. </p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">var</span> newWall = mode.Instances.New&lt;IfcWall&gt;();
</pre></div>

<p>It isn't possible to create new entities in any other way than with this function. You will see in the code above that this function takes optional 
typed object initializer to set up values of the object. It is not necessary to use them but I personally like it because I can see the structure of
the resulting entity.</p>

<p>Using all these basic pieces we can build the first wall.
This wall doesn't have any geometry so most of IFC viewers won't show you anything. But this is just a basic example. Here is the complete code:</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">var</span> editor = <span style="color:Blue;">new</span> XbimEditorCredentials
{
    ApplicationDevelopersName = <span style="color:#A31515;">&quot;xBIM Team&quot;</span>,
    ApplicationFullName = <span style="color:#A31515;">&quot;xBIM Toolkit&quot;</span>,
    ApplicationIdentifier = <span style="color:#A31515;">&quot;xBIM&quot;</span>,
    ApplicationVersion = <span style="color:#A31515;">&quot;4.0&quot;</span>,
    EditorsFamilyName = <span style="color:#A31515;">&quot;Santini Aichel&quot;</span>,
    EditorsGivenName = <span style="color:#A31515;">&quot;Johann Blasius&quot;</span>,
    EditorsOrganisationName = <span style="color:#A31515;">&quot;Independent Architecture&quot;</span>
};
<span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> model = IfcStore.Create(editor, IfcSchemaVersion.Ifc4, XbimStoreType.InMemoryModel))
{
    <span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> txn = model.BeginTransaction(<span style="color:#A31515;">&quot;Hello Wall&quot;</span>))
    {
        <span style="color:Green;">//there should always be one project in the model</span>
        <span style="color:Blue;">var</span> project = model.Instances.New&lt;IfcProject&gt;(p =&gt; p.Name = <span style="color:#A31515;">&quot;Basic Creation&quot;</span>);
        <span style="color:Green;">//our shortcut to define basic default units</span>
        project.Initialize(ProjectUnits.SIUnitsUK);

        <span style="color:Green;">//create simple object and use lambda initializer to set the name</span>
        <span style="color:Blue;">var</span> wall = model.Instances.New&lt;IfcWall&gt;(w =&gt; w.Name = <span style="color:#A31515;">&quot;The very first wall&quot;</span>);

        <span style="color:Green;">//set a few basic properties</span>
        model.Instances.New&lt;IfcRelDefinesByProperties&gt;(rel =&gt; {
            rel.RelatedObjects.Add(wall);
            rel.RelatingPropertyDefinition = model.Instances.New&lt;IfcPropertySet&gt;(pset =&gt; {
                pset.Name = <span style="color:#A31515;">&quot;Basic set of properties&quot;</span>;
                pset.HasProperties.AddRange(<span style="color:Blue;">new</span>[] {
                    model.Instances.New&lt;IfcPropertySingleValue&gt;(p =&gt; 
                    {
                        p.Name = <span style="color:#A31515;">&quot;Text property&quot;</span>;
                        p.NominalValue = <span style="color:Blue;">new</span> IfcText(<span style="color:#A31515;">&quot;Any arbitrary text you like&quot;</span>);
                    }),
                    model.Instances.New&lt;IfcPropertySingleValue&gt;(p =&gt; 
                    {
                        p.Name = <span style="color:#A31515;">&quot;Length property&quot;</span>;
                        p.NominalValue = <span style="color:Blue;">new</span> IfcLengthMeasure(56.0);
                    }),
                    model.Instances.New&lt;IfcPropertySingleValue&gt;(p =&gt; 
                    {
                        p.Name = <span style="color:#A31515;">&quot;Number property&quot;</span>;
                        p.NominalValue = <span style="color:Blue;">new</span> IfcNumericMeasure(789.2);
                    }),
                    model.Instances.New&lt;IfcPropertySingleValue&gt;(p =&gt; 
                    {
                        p.Name = <span style="color:#A31515;">&quot;Logical property&quot;</span>;
                        p.NominalValue = <span style="color:Blue;">new</span> IfcLogical(<span style="color:Blue;">true</span>);
                    })
                });
            });
        });

        txn.Commit();
    }
    model.SaveAs(<span style="color:#A31515;">&quot;BasicWall.ifc&quot;</span>);
}
</pre></div>

<h2>Retrieve</h2>

<p>Retrieving data from the model is very easy and it uses <code>IModel.Instances</code> again to access all entities we need.</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">var</span> firstWall = mode.Instances.FirtsOrDefault&lt;IfcWall&gt;();
<span style="color:Blue;">var</span> allWalls = model.Instances.OfType&lt;IfcWall&gt;();
<span style="color:Blue;">var</span> specificWall = model.Instances.Where&lt;IfcWall&gt;(w =&gt; w.Name == <span style="color:#A31515;">&quot;Brick wall&quot;</span>);
</pre></div>

<p>You can see that all these functions are templated so they use type of the object as the first level filter. If you know the type you want you should
always specify it to increase a performance. For all search queries you can also use interfaces to retrieve entities. We have implemented <strong>IFC4 interfaces
on IFC2x3 entities</strong> which means you can query IFC2x3 and IFC4 with a <strong>single codebase</strong>. </p>

<p>Following example only needs these usings:</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">using</span> System;
<span style="color:Blue;">using</span> System.Linq;
<span style="color:Blue;">using</span> Xbim.Ifc;
<span style="color:Blue;">using</span> Xbim.Ifc4.Interfaces;
</pre></div>

<p>If you are interested in the structure of the entities we recommend you to have a look at IFC documentation <a href="http://www.buildingsmart-tech.org/ifc/">here</a>.</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">const</span> <span style="color:Blue;">string</span> fileName = <span style="color:#A31515;">&quot;SampleHouse.ifc&quot;</span>;
<span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> model = IfcStore.Open(fileName))
{
    <span style="color:Green;">//get all doors in the model (using IFC4 interface of IfcDoor this will work both for IFC2x3 and IFC4)</span>
    <span style="color:Blue;">var</span> allDoors = model.Instances.OfType&lt;IIfcDoor&gt;();

    <span style="color:Green;">//get only doors with defined IIfcTypeObject</span>
    <span style="color:Blue;">var</span> someDoors = model.Instances.Where&lt;IIfcDoor&gt;(d =&gt; d.IsTypedBy.Any());

    <span style="color:Green;">//get one single door </span>
    <span style="color:Blue;">var</span> id = <span style="color:#A31515;">&quot;2AswZfru1AdAiKfEdrNPnu&quot;</span>;
    <span style="color:Blue;">var</span> theDoor = model.Instances.FirstOrDefault&lt;IIfcDoor&gt;(d =&gt; d.GlobalId == id);
    Console.WriteLine($<span style="color:#A31515;">&quot;Door ID: {theDoor.GlobalId}, Name: {theDoor.Name}&quot;</span>);

    <span style="color:Green;">//get all single-value properties of the door</span>
    <span style="color:Blue;">var</span> properties = theDoor.IsDefinedBy
        .Where(r =&gt; r.RelatingPropertyDefinition <span style="color:Blue;">is</span> IIfcPropertySet)
        .SelectMany(r =&gt; ((IIfcPropertySet)r.RelatingPropertyDefinition).HasProperties)
        .OfType&lt;IIfcPropertySingleValue&gt;();
    <span style="color:Blue;">foreach</span> (<span style="color:Blue;">var</span> property <span style="color:Blue;">in</span> properties)
        Console.WriteLine($<span style="color:#A31515;">&quot;Property: {property.Name}, Value: {property.NominalValue}&quot;</span>);
}
</pre></div>

<p>This will write to console:</p>

<pre><code>Door ID: 3cUkl32yn9qRSPvBJVyWYp, Name: Doors_ExtDbl_Flush:1810x2110mm:285860
Property: IsExternal, Value: true
Property: Reference, Value: 1810x2110mm
Property: Level, Value: Level: Ground Floor
Property: Sill Height, Value: 0
Property: Area, Value: 4.9462127188431
Property: Volume, Value: 0.193819981582386
Property: Mark, Value: 1
Property: Category, Value: Doors
Property: Family, Value: Doors_ExtDbl_Flush: 1810x2110mm
Property: Family and Type, Value: Doors_ExtDbl_Flush: 1810x2110mm
Property: Head Height, Value: 2110
Property: Host Id, Value: Basic Wall: Wall-Ext_102Bwk-75Ins-100LBlk-12P
Property: Type, Value: Doors_ExtDbl_Flush: 1810x2110mm
Property: Type Id, Value: Doors_ExtDbl_Flush: 1810x2110mm
Property: Phase Created, Value: New Construction
</code></pre>

<h2>Update</h2>

<p>Update is similar to the previous two. Notice the transaction has to be open and should be enclosed in <code>using</code> statements
or model will throw an exception at the moment you create or change any object.</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">const</span> <span style="color:Blue;">string</span> fileName = <span style="color:#A31515;">&quot;SampleHouse.ifc&quot;</span>;
<span style="color:Blue;">var</span> editor = <span style="color:Blue;">new</span> XbimEditorCredentials
{
    ApplicationDevelopersName = <span style="color:#A31515;">&quot;xBIM Team&quot;</span>,
    ApplicationFullName = <span style="color:#A31515;">&quot;xBIM Toolkit&quot;</span>,
    ApplicationIdentifier = <span style="color:#A31515;">&quot;xBIM&quot;</span>,
    ApplicationVersion = <span style="color:#A31515;">&quot;4.0&quot;</span>,
    EditorsFamilyName = <span style="color:#A31515;">&quot;Santini Aichel&quot;</span>,
    EditorsGivenName = <span style="color:#A31515;">&quot;Johann Blasius&quot;</span>,
    EditorsOrganisationName = <span style="color:#A31515;">&quot;Independent Architecture&quot;</span>
};

<span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> model = IfcStore.Open(fileName, editor, <span style="color:Blue;">true</span>))
{
    <span style="color:Green;">//get existing door from the model</span>
    <span style="color:Blue;">var</span> id = <span style="color:#A31515;">&quot;3cUkl32yn9qRSPvBJVyWYp&quot;</span>;
    <span style="color:Blue;">var</span> theDoor = model.Instances.FirstOrDefault&lt;IfcDoor&gt;(d =&gt; d.GlobalId == id);

    <span style="color:Green;">//open transaction for changes</span>
    <span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> txn = model.BeginTransaction(<span style="color:#A31515;">&quot;Doors modification&quot;</span>))
    {
        <span style="color:Green;">//create new property set with two properties</span>
        <span style="color:Blue;">var</span> pSetRel = model.Instances.New&lt;IfcRelDefinesByProperties&gt;(r =&gt;
        {
            r.GlobalId = Guid.NewGuid();
            r.RelatingPropertyDefinition = model.Instances.New&lt;IfcPropertySet&gt;(pSet =&gt;
            {
                pSet.Name = <span style="color:#A31515;">&quot;New property set&quot;</span>;
                <span style="color:Green;">//all collections are always initialized</span>
                pSet.HasProperties.Add(model.Instances.New&lt;IfcPropertySingleValue&gt;(p =&gt;
                {
                    p.Name = <span style="color:#A31515;">&quot;First property&quot;</span>;
                    p.NominalValue = <span style="color:Blue;">new</span> IfcLabel(<span style="color:#A31515;">&quot;First value&quot;</span>);
                }));
                pSet.HasProperties.Add(model.Instances.New&lt;IfcPropertySingleValue&gt;(p =&gt;
                {
                    p.Name = <span style="color:#A31515;">&quot;Second property&quot;</span>;
                    p.NominalValue = <span style="color:Blue;">new</span> IfcLengthMeasure(156.5);
                }));
            });
        });

        <span style="color:Green;">//change the name of the door</span>
        theDoor.Name += <span style="color:#A31515;">&quot;_checked&quot;</span>;
        <span style="color:Green;">//add properties to the door</span>
        pSetRel.RelatedObjects.Add(theDoor);

        <span style="color:Green;">//commit changes</span>
        txn.Commit();
    }

}
</pre></div>

<h2>Delete</h2>

<p>Delete is kind of the most complicated operation with the model. First thing to know is that it is only completely implemented in MemoryModel (October 2016).
The reason why this is complicated is that IFC data model is very complex and it isn't hierarchy or directional graph. So our implementation of delete only makes sure
that no object in the model is referencing the object you delete so the model stays consistent. But it doesn't automatically delete any objects referenced from it or 
referring to it. There are choices to be made by programmer or user. However, low level infrastructure for delete can be used very simply:</p>

<div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> model = IfcStore.Open(fileName))
{
    <span style="color:Green;">//get existing door from the model</span>
    <span style="color:Blue;">var</span> id = <span style="color:#A31515;">&quot;3cUkl32yn9qRSPvBJVyWYp&quot;</span>;  <span style="color:Green;">//use some existing ID from your model</span>
    <span style="color:Blue;">var</span> theDoor = model.Instances.FirstOrDefault&lt;IIfcDoor&gt;(d =&gt; d.GlobalId == id);

    <span style="color:Green;">//open transaction for changes</span>
    <span style="color:Blue;">using</span> (<span style="color:Blue;">var</span> txn = model.BeginTransaction(<span style="color:#A31515;">&quot;Delete the door&quot;</span>))
    {
        <span style="color:Green;">//delete the door</span>
        model.Delete(theDoor);
        <span style="color:Green;">//commit changes</span>
        txn.Commit();
    }

}
</pre></div>

    </div>
	    


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
