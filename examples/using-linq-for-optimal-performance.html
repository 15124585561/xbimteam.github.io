<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="xBIM Toolkit is an Open Source toolkit for IFC and BIM. You can use it to do anything with IFC. It implements IFC2x3 and IFC4 and allows to develop SW agnostic to IFC version and file format.">
    <meta name="author" content="xBIM Team">
    <link rel="icon" href="../img/favicon.ico">

    <title>Using Linq for Optimal Performance</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="../css/codestyles.css" rel="stylesheet">
    <link href="../css/site.css" rel="stylesheet">

    <script src="../js/jquery.min.js"></script>

  </head>
<!-- NAVBAR
================================================== -->
  <body>

    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html"><img alt="logo" src="../img/logos/xbim_white_h35.png"/></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          		   
	<ul class="nav navbar-nav">
		
        <li>
			<a href="../quick-start.html">Quick Start</a>
		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Examples <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		<li role="separator" class="group-divider">Basic </li>
		
        <li>
			<a href="../examples/basic-model-operations.html">Basic Model Operations</a>
		</li>
		
        <li>
			<a href="../examples/proper-wall-in-3d.html">Proper Wall in 3D</a>
		</li>
		
        <li>
			<a href="../examples/step-to-xml-and-back-again.html">STEP to XML and Back Again</a>
		</li>
		
        <li>
			<a href="../examples/creating-wexbim-file.html">Creating wexBIM file</a>
		</li>
        <li class="active">
			<a href="../examples/using-linq-for-optimal-performance.html">Using Linq for Optimal Performance</a>
		</li>
		<li role="separator" class="group-divider">Advanced </li>
		
        <li>
			<a href="../examples/federating-models.html">Federating Models</a>
		</li>
		
        <li>
			<a href="../examples/insert-copy-function.html">Insert Copy Function</a>
		</li>
		
        <li>
			<a href="../examples/change-log-creation.html">Change Log Creation</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">xBIM 4 <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../xbim-4/fast-upgrade-track.html">Fast Upgrade Track</a>
		</li>
		
        <li>
			<a href="../xbim-4/xbim-4-release-notes.html">xBIM 4 Release Notes</a>
		</li>
    </ul>

		</li>
        <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">License <span class="caret"></span></a>
			
	<ul class="dropdown-menu">
		
        <li>
			<a href="../license/license.html">License</a>
		</li>
		
        <li>
			<a href="../license/third-party-licenses.html">Third Party Licenses</a>
		</li>
    </ul>

		</li>
    </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>

	<div class="container">
	<h1>Using Linq for Optimal Performance</h1>

<p>Following code will only execute the <code>IEnumerable</code> once you actually access it. Furthermore xBIM uses type of entities internally as
a first level filter so you should ask for the most specific type you can. Keep in mind that <code>IModel.Instances</code> contains <strong>all</strong> entities
in the model which is typically hundreds of thousands objects! So you don't want to iterate over all of them to do anything. </p>

<div class="csharp"><pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> SelectionWithLinq()
{
    <span class="keyword">const</span> <span class="keyword">string</span> ifcFilename = <span class="string">&quot;SampleHouse.ifc&quot;</span>;
    <span class="keyword">var</span> model = <span class="type">IfcStore</span>.Open(ifcFilename);
    <span class="keyword">using</span> (<span class="keyword">var</span> txn = model.BeginTransaction())
    {
        <span class="keyword">var</span> requiredProducts = <span class="keyword">new</span> <span class="type">IIfcProduct</span>[0]
            .Concat(model.Instances.OfType&lt;<span class="type">IIfcWallStandardCase</span>&gt;())
            .Concat(model.Instances.OfType&lt;<span class="type">IIfcDoor</span>&gt;())
            .Concat(model.Instances.OfType&lt;<span class="type">IIfcWindow</span>&gt;());

        <span class="comment">//This will only iterate over entities you really need (9 in this case)</span>
        <span class="keyword">foreach</span> (<span class="keyword">var</span> product <span class="keyword">in</span> requiredProducts)
        {
            <span class="comment">//Do anything you want here...</span>
        }

        txn.Commit();
    }
}
</code></pre></div>

<div class="alert alert-danger" role="alert"> 
    <strong>Please, never use this kind of code:</strong>
</div>

<div class="csharp"><pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> SelectionWithoutLinq()
{
    <span class="keyword">const</span> <span class="keyword">string</span> ifcFilename = <span class="string">&quot;SampleHouse.ifc&quot;</span>;
    <span class="keyword">var</span> model = <span class="type">IfcStore</span>.Open(ifcFilename);
    <span class="keyword">using</span> (<span class="keyword">var</span> txn = model.BeginTransaction())
    {
        <span class="comment">//this will iterate over 47309 entities instead of just 9 you need in this case!</span>
        <span class="keyword">foreach</span> (<span class="keyword">var</span> entity <span class="keyword">in</span> model.Instances)
        {
            <span class="keyword">if</span> (entity <span class="keyword">is</span> <span class="type">IIfcWallStandardCase</span> ||
                entity <span class="keyword">is</span> <span class="type">IIfcDoor</span> ||
                entity <span class="keyword">is</span> <span class="type">IIfcWindow</span>)
            {
                <span class="comment">//You may want to do something here. Please DON&#39;T!</span>
            }
        }


        txn.Commit();
    }
}
</code></pre></div>

    </div>
    

	<div class="brands-container">
	<p><small>Some of the companies using xBIM Toolkit:</small></p>
		<img src="../img/logos/northumbria_logo_gray.png" class="brand"/>
		<img src="../img/logos/viewpoint_logo_gray.png" class="brand"/>
		<img src="../img/logos/welplan_logo_gray.png" class="brand"/>
		<img src="../img/logos/nbs_logo_gray.png" class="brand"/>
		<img src="../img/logos/bim_academy_logo_gray.png" class="brand"/>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
